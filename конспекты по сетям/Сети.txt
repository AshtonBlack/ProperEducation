Сети:
1. с коммутацией каналов (в телефонной сети)
2. с коммутацией пакетов. Передаваемые пакеты делятся на пакеты, которые могут идти разными путями.
Это приводит к отказоустойчивости. Путь выбирается маршрутизатором отдельно для каждого пакета- это влечет 
за собой вычислительные нагрузки на маршрутизатор.
Технологи пердачи:
1.Широковещательная. (компьютеры подключены к общей шине, классический ethernet, wifi)
К данным имеют доступ все участники сети.
2. Точка-точка. (коммутируемый ethernet)
Данные переходят от одного компа к другому, иногда через несколько промежуточных узлов.
Протяженность сетей:
1.Персональная, 1м (блютус)
2.Локальная 10-1000м (комната, здание, кампус)
Реализуется wifi, ethernet
3.Муниципальная 10000м (городская)
4.Глобальные сети 100-1000км (страна, континент)
5.Объединение сетей 10000км (мир)
реализуется стеком TCP/IP.

Топология(способ соединения) сетей.
Представляется графом.
Его вершины- узлы (компы, сетевое оборудование)
Ребра- связи между узлами (физические или информационные)
1. Полносвязная сеть - каждое устройство напрямую соединено с каждым. Частный случай - 
ячеистая (в ней отсутствуют некоторые связи).
2. Звезда- через центральное устройство (коммутатор/свитч, концентратор, маршрутизатор или точка доступа wifi.
3. Кольцо. Компы соединены с соседними.
4. Дерево- его образуют компы и сетевое оборудование.
5. Общая шина (обычно через медный кабель). Данные в шине доступны всем.
6. Смешанная топология (используется чаще всего)
Физическая топология- соединений устройств. 
Логическая т. - правила распространения сигнала в сети.
Иногда физическая и логическая топология не соответствуют. При центральном концентраторе в звезде логическая 
топология - общая шина. При комутируемом ethernet, звезда со свитчем в центре образуется логическая полносвязная топология.
В wifi отсутствуют физические соединения, а логически- общая шина.

Стандарты.
На ранних этапах были несовместимости в сетевом оборудовании/программном обеспечении/различных протоколах.
De juro (юридические) - приняты по законам стандартизации
De facto (фактические) - устоявшиеся, типа TCP/IP
Основные стандарты:
ISO - эталонная модель OSI
IEEE - технологии передачи данных (док. по оборудованию)
802.3 Ethernet
802.11 локальные сети wifi
802.15 bluetooth
802.16 Широкополосные сети wimax
IAB - протоколы интернета (RFC протоколы интернета)
W3C - стандарты(рекомендации) WEB
HTML, CSS, Архитектура web сервисов, XML

Построение сетей.
Декомпозиция, шаблон "уровни"- разделение задач между уровнями.
Сервис - функции уровня.
Интерфейс - набор примитивных операций, который предоставояется нижним уровнем верхнему, и пользуется функциями более 
низкого уровня на одном компе.
Протокол - правила, которые используются для связи одного уровня на разных компьютерах. Виртуальное общение между 
компьютерами происходит через заголовки протоколов.
Архитектура сети задает набор уровней и протоколов.
Стек протоколов- иерархический набор протоколов, достаточный для организации взаимодействия по сети.
Модель OSI - не имеет протоколов.
Модель TCP/IP - состоит из протоколов.
Инкапсуляция - содержание сообщения протокола верхнего уровня в сообщении нижнего уровня.
Сообщение = заголовок + данные + концевик.

Модель
OSI (open system interconnection)
Открытая система - общедоступные спецификации, на основе которых можно строить системы из компонентов разных производителей,
заменять компоненты, обьединять сети.
Не является сетевой архитектурой, так как не имеет протоколов.
Уровни:
Прикладной - набор приложений для польхователей сети.
Представление - пример с переводом телефонного разговора. Шифрование и дешифрование.
Сеансовый - устанавливает сеансы связи. следит за очередностью передачи сообщений. Синхронизация при восстановлении связи.
Транспортный - обеспечивает передачу сообщений между процессами. Обеспечивает более высокую надежность. Защищенный канал связи с гарантированным 
порядком следования сообщений. Является сквозным, сетенезависимый (потому как изолирован от сетевого оборудования).
Сетевой - объединяет сети, построенные на разных технологиях. Адресация с помощью глобальных адресов, которая позволяет однозначно определить компьютер
в составной сети. Маршрутизация.
Канальный- передача сообщений, определяет конец и начало сообщения в потоке бит, обнаружение и коррекция ошибок. Обеспечивает физическую
адресацию, управление доступом к среде передачи данных. Одновременно данные может передавать только 1 комп.
Физический- передача битов по каналу связи, представляет биты в виде сигналов
бит, кадр, пакет, сегмент/датаграмма, сообщение
концентратор - физический
канальный - коммутатор, точка доступа вайфай
сетевой - маршрутизатор

Модель и стек TCP/IP
Является моделью de facto.
Прикладной (HTTP, SMTP, DNS, FTP, ...)
Транспортный (TCP, UDP)
Интернет (IP) + (ICMP + ARP + DHCP)
Сетевых интерфейсов (Ethernet, WIFI, DSL)
Пятиуровненвая модель:
Прикладной 
Транспортный 
Сетевой 
Канальный 
Физический

Физический Уровень
Основная задача- передача информации в битах.
Основные характеристики:
Пропускная способность (биты в секунду)
Задержка (время пути от отправителя до получателя)
Количество ошибок
Типы каналов:
Симпликсный (в одну сторону)
Дуплексный (в обе)
Полудуплексный (в обе поочереди)
Кабеля
В современных сетях используют витую пару(провода скручены попарно, в кабеле обычно 4), оптический, радиоволны, инфракрасное излучение (в пультах)
Редко используют спутник, лазеры.
Радиоволны:
900МГц - сотовые
2.4 и 5ГГц - WIFI
Кол-во ошибок:
Оптика- очень редко (синосуидальные волны)
Витая пара- редко (сигнал осуществляется прямоугольными импульсами)
WiFi- часто (синосуидальные волны)

Канальный уровень
Основная задача- передача сообщений, кадров(frame).
Определяется начало сообщения и конец сообщения, обнаружение ошибок.
Адресация, согласованный доступ к каналу.
Добавляет к пакету заголовок и концевик.
Методы определения границ кадров:
- указывать длинну кадров
- вставка последовательности байтов или бит (пртокол BSC: STX, ETX) + (HDLC и PPP: 01111110)
- В классическом ethernet преамбула 7 байт 10101010, последний байт 10101011
- В fast ethernet используются символы избыточного кода. Начало кадра- пара J(11000), K(10001), конец- T(01101)
Обнаружение ошибок - контрольная сумма.
Исправление ошибок. Используются спец коды исправления ошибок. Или повторная отправка битых кадров.
Остановка и ожидание - подтверждение на каждый кадр.
Скользящее окно - передача нескольких кадров (размер кадра), получатель подтверждает получение кадров. (работает на траспортном уровне в TCP).
Каналы с редкими ошибками редактируют ошибки на верхних уровнях, а с частыми (wifi) на канальном.
Канальный уровень разделили на два подуровня:
-Подуровень управления логическим каналом LLC (создание кадров, обработка ошибок и является общим)
отвечает за передачу данных нескольких протоколов вышестоящего уровня. Управление потоком (защита от затопления)
-Подуровень управления доступа к среде MAC (адресация, совместное использование среды)
Защита от коллизий. Одновременно может передавать данные только один отправитель. Рандомизированный и токен ринг технологии.

Ethernet
Содержит в себе физический и канальный уровень.
Проект IEEE 802.3 стал юридическим стандартом. 
Ethernet
Fast Ethernet
Gigabit Ethernet
5G Ethernet - только на витой паре для локалок
10G Ethernet - для сервов
100G Ethernet - для сервов
Классический и Коммутируемый Ethernet
Классический с разделяемой средой для передачи данных. До технологии 1гигабит
Коммутируемый работает - точка-точка. 
В основе классического ethernet работал на топологии общей шины. Позже использовались Концентраторы/Хабы. После чего
физическая топология стала - звездв.
Сейчас используют Ethernet II и IEEE 802.3.
Формат кадра:
Адрес получателя|Адрес отправителя|Тип протокола(IPv4/IPv6/ARP)|Данные|Контрольная сумма
Данные могут быть от 46 до 1500байт.

MAC адреса
Адреса канального уровня.
Ethernet 802.3
Wifi 802.11
Длинна адреса 6 байт, 6 шестнадцатиричных чисел
Адреса бывают:
unicast (индивидуальный)
multicast (групповой, первый бит старшего байта 01-...)
broadcast (широковещательный, FFFFFFFF..)
MAC адреса в сегменте сети не должны повторяться.
Централизованный способ назначение MAC адресов- выдается производителем оборудования. В локальном способе назначаются админом.
Второй бит старшего байта отражает способ назначения адреса. (0 - центр., 1 - локально)

Ethernet. Метод доступа CSMA/CD
Множественный доступ с прослушиванием частоты и обнаружкнием коллизий.
Для обнаружения колллизий комп передает и принимает данные одновременно. Если данные различны- образовалась коллизия.
При обнаружении коллизии комп передает JAM последовательность (для усиления коллизии).
Период передачи/период конкуренции/период простоя.
Преамбула/кадр/межкадровый простой.
После передачи преамбулы комп передаут кадр. Его получают все и записывают в буффер. Считывается мак адрес получателя в первых 6 
байтах. Далее в буфер данные записывает только адресат, остальные откидывают кадр. Межкадровый интервал 9.6мкс против монополии.
Пауза во время периода конкуренции - рандом.

Коммутаторы
Нет разделяемой среды. тип подключения точка-точка.
Внутри устройства полносвязная топология. Работает на канальном уровне, извлекает МАС и направляет сообщение адресату.
Таблица коммутации строится алгоритмом обратного обучения, после чего используется алгоритм прозрачного моста.
Прозрачный мост не имеет сетевого адреса и не требует настройки.

VLAN
Делит одну сеть на несколько логических частей.
Для определения VLAN в кадр в тип протокола верхнего уровня вставляется особая метка. Далее на месте данных ставится тэг VLANа, а далее 
прописывается протокол верхнего уровня. Для поддержания прежнего обьема данных величина кадра была увеличена.

STP
Протокол, который логически разрывает кольцевые соединеия сети, против возникновения широковещательного шторма.
На первом этапе определяется корневой коммутатор, на втором- считается путь от каждого до коневого.
Для реализации протокола каждые 2с коммутаторы обмениваются BPDU сообщениями. Используется групповой MAC адрес STP.

WiFi
На одной частоте работают до 14 каналов.
Различаются ширины каналов 20-160Мгц. Чем шире- тем лучше.
MIMO возможность использовать несколько антен.
Проблема скрытой станции. Компы в разделяемой среде проверяют эфир перед передачей данных. Однако, передающие могут не видеть друг друга.
Проблема засвеченной станции. Когда две сети раюотают рядом, и один источние попадает в радиус действия другого.
Из-за частых ошибок подтверждение отправляется на каждый кадр. Используется метод CSMA/CA:
Кадр|Короткое ожидание|Подтверждение|Длинное одидание|Период Молчания
Так же опционально используется MACA, который может решить проблему скрытой и засвеченой станции. В этом способе перед передачей данных 
отправляется RTS(request to send) с размером сообщения. Приемник отправляет в ответ CTS (Clear to Send) с размером ожидавмого 
сообщения. Другие компы видят CTS и ждут время передачи и подтверждения.
В WIFI используются 4 адреса:
Deastination Address
Source Address
Reciever Address
Transmitter Address
Данные 2304байта.
При необходимости происходит фрагментация.

Сервисы WiFi
- Ассоциации. параметры с которыми он может работать
- Аутентифиувция. открытая/personal/enterprise
- Передача данных
- Защита информации (шифрование)
- Роуминг
Пассивное и активное сканирование.
SSID текстовый идентификатор
BSSID MAC адресс

Сетевой Уровень
Адресация. Для определения глобального адреса внутри локальной сети используется ARP запрос.
Фрагментация для согласования размера кадра в составной сети.
Проблемы канального уровня решаемые сетевым:
1. таблицы коммутации (гигантские)
2. широковещательные запросы
3. отсутствие дублирующих соединений
Агрегация адресов. Работа с блоками адресов (сетями).
Отбрасывание пакетов с неизвестным адресом.
Возможность нескольких активных путей. (Маршрутизация - поиск путей через транзитные узлы, маршрутихаторы)
Протоколы сетевого уровня: ARP (определение по IP определение MAC), IP (передача данных), ICMP (управление сетью), DHCP (Назначение IP компам).

IP Адреса
Глобальные адреса (ip) состоят и 32 бит и делятся на 4 октета. Работа на сетевом уровне происходит не с компьютерами, а подсетями.
Старшие биты- это адресс подсети, а младшие - адресс компьютера. Маска подсети записывается в виде 4 октетов или в виде префикса(/24).
Маски могут быть переменной длинны и не заканчиваться на границе октета.
Ранее были Классы IP адресов.
Адреса бывают:
unicast (индивидуальный, адрес компа)
multicast (групповой, используется несколькими компами, при отправке на него, сообщение получат несколько компов)
broadcast (широковещательный, получают все участники сети, адрес сети, соответствующий маске, остается прежним, 
а в адресе хоста записываются все битовые единицы).
Широковещательные адреса передаются только внутри подсети.
Ограниченное широковещание- источник широковещательного сигнала внутри сети (используется адрес 255.255.255.255)
Направленное широковещание - источник находится за пределами сети (Адрес подсети + .255)
Обратная петля 127.0.0.0/8 для тестов сетевых приложений на компьютере.
Link-local адреса (169.254.0.0/16) используются в пределах подсети.
Частные ip адреса:
10.0.0.0/8
172.16.0.0/12
192.168.0.0/16
Они не маршрутизируются в интернет. Однако такую сеть можно подключить к интернет через трансляцию сетевых адресов (NAT). в зтом
случае локальный адрес заменяется на реальный ip адрес. NAT решает проблему ограничения ip адресов, когда для крупной подсети имеется 1 внешний
ip адрес.

Протокол IP
Сетевой уровень. Не гарантирует доставку и порядок следования сообщений.
Используется передача данных без установки соединения.
Задачи IP:
- Объединение сетей
- Маршрутизация
- Качество обслуживания
Пакет
|Вверсия протокола|Длина заголовка|Тип Сервера (редко используется)|общая длина всего пакета|
|Поля Фрагментации| | |
|TTL|тип протокола следующего уровня (ICMP 1, UDP 17, TCP 6)|контрольная сумма|
|ip адрес отправителя|
|ip адрес получателя|
|Опции выравнивания (запись маршрута или временные метки, так же вместо автоматической маршрутизации можно задать марщрут вручную)|
Опции используются крайне редко.

Маршрутизация
- Изучение сети
- Продвижение пакетов
Маршрутизатор отбрасывает неизвестные пакеты.
Шлюз - путь маршрутизатора-посредника.
На данный момент метрика учитывает не только кол-во маршрутизаторов, но и пропускные возможности/загруженности каналов.
Виды:
- Статическая (вручную)
- Динамическая (протоколы маршрутизации RIP, OSPF, BGP)
В таблице маршрутизации обычно назначается маршрутизатор по умолчанию, на который отправляются пакеты для неизвестных сетей. Он
обычно подключен к интернет. Условное обозначение маршрута по умолчанию 0.0.0.0 или default.
Просмотр таблицы route/ip route/route print.

Фрагментация
|Идентификатор пакета|Флаг|Смещение фрагмента|
При запрете фрагментации и отправке пакета по объему больше MTU пакет отбрасывается, и будет выслано сообщение ICMP об ошибке.

Управляющие протоколы сетевого уровня
- ICMP (internet control message protocol) - сообщения об ошибках, тестирование работы сети (ping, traceroute). Формат протокола:
|Тип Сообщения|Код Сообщения|Контрольная Сумма|
|Служебная Информация (зависит от типа и кода)|
|Поле Данных|
Существует два типа ICMP сообщений запрос-ответ и просто сообщения без запроса. Смотреть таблицы.
Утилита trceroute генерирует несколько ICMP сообщений (каждый раз увеличивая время жизни на 1), после чего из ICMP ответа от маршрутизатора
"время жизни истекло" ивлекает адрес маршрутизатора.
- ARP (adress resolution protocol) - определение mac адреса по ip. Самое простое средство определение МАС адреса- таблица 
соответствия. В линукс cat /etc/ethers. ARP запрос помогает определить МАС адрес автоматически без таблицы.
- DHCP (dynamic host configuration protocol) - служит для получения ip. DORA - discover offer request acknowledgment. Адрес выделяется
на некоторое время аренды. Для продления аренды отправляется упрощенная форма. DHCP сервер должен располагаться в одной подсети с клиентами.
Для устранения подобной проблемы на маршрутизаторах может быть использована конфигурация DHCP Relay.(передаёт широковещательный 
трафик сообщений DHCP)

Передача данных на канальном и сетевом уровнях
На канальном уровне передача данных работает как звенья цепи и МАС адрес меняется на каждом этапе, в то время как IP адрес остается прежним.

Транспортный Уровень
Основная задача передача данных между процессами на разных хостах. Адресация. Обеспечение надежности при необходимости.
Хост - устройство, где работают пользовательские программы, содержит все семь уровней.
Сетевое оборудование - имеет только 3 нижних уровня.
Адрес на транспортном уровне - порт, число от 0 до 65535. каждое приложение на компе имеет свой порт. Номера портов у приложений не повторяются.
Форма записи: IP + Port.
Хорошо известные порты:
- 80 HTTP
- 25 SMTP (mail)
- 53 DNS
- 67, 68 DHCP
Зарегестрированные порты: 1025-49151.
Динамические порты: 49151-65535 автоматически назначаются операционкой.
Протоколы TCP и UDP.
Для взаимодействия с транспортным уровнем используется интрефейс сокетов.

UDP (user datagram protocol)
Формат:
|Порт пользователя|Порт получателя|
|Длина UDP|Кнотрольная сумма UDP|
При потери запроса приложение по таймеру отправляет повторный запрос.

TCP (transmission control protocol)
Данные передаются потоком байт, в TCP поток делится на сегменты.
Нумерация сообщений. Отправитель высылает сообщение с кол-вом байт. Получатель высылает сообщение, что ждет следующий байт.
Перед отправлением данных устанавливается соединение. После завершения передачи данных соединение разрывается.
Подтверждение доставки:
- Остановка-ожидание (поочередно отправляются данные и подтверждения)
- Скользящее окно (получатель отправляет коммулятивное подтверждение), кумулятивное подтверждение (подтверждение указанного объема)
/выборочное подтверждение (подтверждает диапазон) - для этого используются дополнительных полей заголовка (параметров).
Подключение:
Syn byte n      ->
Syn+Ack byte n+ <-
Ack byte n+     ->
Разъединение:
1.Корректное:
Fin ->
Ack <-
Fin <-
Ack ->
2.Критическое:
Rst ->
Формат Заголовка:
|Порт отправителя|Порт получателя|
|Порядковый номер|
|Номер подтвердления|
|Длина заголовка| |NS|CWR|ECE|URG|ACK|PSH|RST|SYN|FIN|Размер окна| - первые три флага для перегрузки, urg -срочные данные(обычно не используеттся), psh - передать приложению без записи в буфер (не используется)
|Контрольные данные|Указатель на срочные данные|
|Параметры|
|Данные|
Управление потоком - предотвращение затопления. Для этого указывается максимальное кол-во данных, которое способен принять получатель
в размере окна. В случае, если получатель отправил сообщение о заполненном буфере, спустя время отправитель может переспросить получателя
с помощью Zero Window Probe.
Управление перегрузки (маршрутизаторы не справляются с потоком данных) находится на стороне отправителя. Используется метод адитивного увеличения (при каждой удачной передаче данных размер 
окна увеличивается на 1 сегмент), мультипликативного уменьшения (Умножение на некоторое число, обычно 1/2). Сейчас сначала (до порога медленного старта)
используется медленный старт, размер окна увеличивается экспоненциально. Сигналы перегрузки:
- Потеря сегмента
- Задержка сегмента
- Сигнал маршрутизатора (random early detection - маршрутизатор заранее отбрасывает пакеты, предотвращая перегрузку, explicit congestion notification - явный сигнал
маршрутизатора к отправителю (через установление флага в сообщении к получателю) о перегрузке в сети. Флаги перегрузки устанавливаются и в IP маршрутизатором и в TCP,
поле ECE устанавливается получателем, в ответ отправитель подтверждает получение сообщения о перегрузке флагом CWR. NS- защита от установки неверных флагов ECN.

Интерфейс сокетов.
Операции:
Socket (создание)
Bind
Listen
Accept
Connect
Send
Recieve
Close

NAT
Трансляция сетевых адресов. Преобразование внутренних IP адресов внешними. Позволяет преодолеть нехватку IPv4 адресов.
Внешние IP адреса - применяются в интернет, должны быть уникальны.
Внутренние адреса для создание частных сетей (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16). Не могут использоваться в интернет, но
могут использоваться в любой частной сети и повторяться.
- Статический NAT (редко)
- Динамический NAT (несколько внешних адресов поочередно используются внутренними компами)
- Один ко многим (masquerading, 1 внешний айпи), NAT устройство записывает в таблицу внутренний IP и порт, и генерирует внешнюю адрес для замены в пакете (свой IP, 
и случайный порт).
NAT Traversal - позволяет установить соединение с компом во внуттенней сети. (пример Skype)

Межсетевые экраны
Устройство или программа для разделения сетей. (брандмауэр, фаервол) Работают на сетевом и на транспортном уровне, анальзуруют айпи отправителя/получателя, 
порты транспортного уровня. Содержит в себе таблицу правил.

DNS
Определение айпи по доменному имени.
nslookup (host, dig для Linux) имя домена.
Итеративный режим сервера- клиент несколько раз самостоятельно уточняет информацию о конечном DNS-сервере, содержащим ip адрес домена.
Рекурсивный режим сервера- DNS сервер самостоятельно находит информацию о домене. (Небольшие локальные DNS resolver, предоставляемые провайдером или открытый сервер).
DNS Resolver имеет кэш, потому его данные не авторитетны.

